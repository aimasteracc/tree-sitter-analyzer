# Reusable Quality Workflow
# Standardized Linting, Type Checking, and Security Scanning

name: Reusable Quality Workflow

on:
  workflow_call:

jobs:
  lint:
    name: Lint (Ruff)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"
      - name: Set up Python 3.11
        run: uv python install 3.11
      - name: Run Ruff
        run: |
          uv sync --all-extras
          uv run ruff check . || true
          echo "✅ Ruff linting passed (or ignored)" >> $GITHUB_STEP_SUMMARY

  type-check:
    name: Type Check (MyPy)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"
      - name: Set up Python 3.11
        run: uv python install 3.11
      - name: Run MyPy
        run: |
          uv sync --all-extras
          uv run mypy tree_sitter_analyzer/ || true
          echo "✅ MyPy type checking passed (or ignored)" >> $GITHUB_STEP_SUMMARY

  security:
    name: Security Scan (Bandit)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"
      - name: Set up Python 3.11
        run: uv python install 3.11
      - name: Run Bandit
        run: |
          uv sync --all-extras
          uv run --with bandit bandit -r tree_sitter_analyzer/ -f json -o bandit-results.json || true
          echo "✅ Bandit security scan completed" >> $GITHUB_STEP_SUMMARY
