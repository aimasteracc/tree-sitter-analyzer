# テストケース一覧

**文書番号:** TEST-002  
**バージョン:** 1.0  
**作成日:** 2025-11-02  
**最終更新:** 2025-11-03  
**総テスト数:** 3,370+

---

## 1. テストケース概要

Tree-sitter Analyzerプロジェクトは、**3,370件以上のテストケース**を保有し、100%の合格率を維持している。

### 1.1 テストケース分類

| カテゴリ | テスト数 | 合格率 | カバレッジ |
|---------|---------|--------|-----------|
| **単体テスト** | ~3,000 | 100% | 85-90% |
| **統合テスト** | ~300 | 100% | 80-85% |
| **E2Eテスト** | ~100 | 100% | 75-80% |
| **パフォーマンステスト** | ~50 | 100% | N/A |
| **セキュリティテスト** | ~100 | 100% | 95% |

---

## 2. 機能別テストケース

### 2.1 コア解析エンジン

#### ファイル: `tests/test_core_engine_extended.py`
**テスト数:** 150+

| テストID | テスト名 | 目的 | 優先度 |
|---------|---------|------|--------|
| CE-001 | 基本構文解析 | tree-sitter統合検証 | 必須 |
| CE-002 | エラーハンドリング | 不正ファイル処理 | 必須 |
| CE-003 | 大規模ファイル解析 | パフォーマンス検証 | 高 |
| CE-004 | Unicode対応 | 多言語文字処理 | 高 |
| CE-005 | 並行処理 | 複数ファイル同時解析 | 中 |

#### ファイル: `tests/test_core_query_service.py`
**テスト数:** 200+

主要テスト:
- QueryService基本機能
- キャッシュ統合
- 非同期クエリ
- エラー復旧

### 2.2 言語プラグイン

#### Javaプラグイン (`tests/test_java_structure_analyzer.py`)
**テスト数:** 300+

| カテゴリ | テスト内容 | ケース数 |
|---------|-----------|---------|
| **基本要素** | クラス、メソッド、フィールド抽出 | 50 |
| **Spring対応** | @Autowired, @Service等 | 30 |
| **JPA対応** | @Entity, @Repository等 | 25 |
| **複雑度計算** | Cyclomatic Complexity | 20 |
| **継承・実装** | extends, implements解析 | 30 |
| **エッジケース** | ネスト、匿名クラス等 | 145 |

#### JavaScriptプラグイン (`tests/test_javascript_plugin_comprehensive.py`)
**テスト数:** 250+

主要機能:
- ES6+構文（アロー関数、クラス、async/await）
- React JSX対応
- フレームワーク検出
- モジュールシステム（import/export）

#### TypeScriptプラグイン (`tests/test_typescript_plugin.py`)
**テスト数:** 200+

主要機能:
- 型システム（インターフェース、型エイリアス）
- デコレータ
- TSX/JSX対応
- 名前空間

#### Pythonプラグイン (`tests/test_python_plugin.py`)
**テスト数:** 180+

主要機能:
- 型アノテーション
- デコレータ
- async/await
- データクラス

#### HTML/CSSプラグイン
**テスト数:** 150+ (各75+)

- HTML: DOM構造、要素分類、属性解析
- CSS: セレクタ、プロパティ分類、詳細度

### 2.3 MCP統合

#### ファイル: `tests/test_mcp_async_integration.py`
**テスト数:** 150+

| ツール | テスト内容 | ケース数 |
|--------|-----------|---------|
| **check_code_scale** | スケール確認、トークン最適化 | 25 |
| **analyze_code_structure** | 構造解析、SMART要約 | 30 |
| **extract_code_section** | セクション抽出、行範囲指定 | 20 |
| **list_files** | ファイル一覧、フィルタリング | 25 |
| **search_content** | コンテンツ検索、トークン制限対応 | 30 |
| **find_and_grep** | 複合検索、2段階フィルタリング | 20 |

#### MCP互換性テスト (`compatibility_test/`)
**テスト数:** 100+

- Claude Desktop統合
- Cursor統合
- MCP直接実行
- エラーハンドリング

### 2.4 CLI機能

#### ファイル: `tests/test_cli_comprehensive.py`
**テスト数:** 250+

| コマンド | テスト内容 | ケース数 |
|---------|-----------|---------|
| **tree-sitter-analyzer** | メイン解析コマンド | 80 |
| **list-files** | ファイル検索 | 60 |
| **search-content** | コンテンツ検索 | 60 |
| **find-and-grep** | 複合検索 | 50 |

主要テスト観点:
- 引数検証
- 出力形式（JSON/YAML/Text）
- ファイル出力
- エラーメッセージ

### 2.5 検索機能

#### ファイル検索 (`tests/test_mcp_fd_rg_tools.py`)
**テスト数:** 100+

- パターンマッチング
- プロジェクト境界保護
- .gitignore尊重
- シンボリックリンク処理

#### コンテンツ検索 (`tests/test_mcp_rg_phase*.py`)
**テスト数:** 150+

- 正規表現検索
- ファイルタイプフィルタ
- コンテキスト表示
- グループ化

### 2.6 パフォーマンス最適化

#### キャッシュ (`tests/test_cache_logic_only.py`)
**テスト数:** 80+

- ファイルキャッシュ
- タイムスタンプ検証
- LRU戦略
- 無効化処理

#### 非同期処理 (`tests/test_async_*.py`)
**テスト数:** 120+

- 並行ファイル処理
- 非ブロッキングI/O
- エラー伝播

### 2.7 セキュリティ

#### ファイル: `tests/security/test_mcp_security.py`
**テスト数:** 100+

| テスト内容 | ケース数 | 優先度 |
|-----------|---------|--------|
| **パストラバーサル防止** | 30 | 必須 |
| **シンボリックリンク検証** | 20 | 必須 |
| **権限チェック** | 15 | 必須 |
| **入力検証** | 25 | 高 |
| **エラーハンドリング** | 10 | 中 |

---

## 3. テストシナリオ

### 3.1 ユーザーワークフロー

#### シナリオ1: AIユーザー（MCP経由）
```
1. Claude DesktopからMCPサーバー起動
2. check_code_scale でプロジェクト規模確認
3. analyze_code_structure で主要クラス抽出
4. extract_code_section で特定メソッド取得
5. search_content で関連コード検索
```
**関連テスト:** `test_mcp_async_integration.py::test_full_workflow`

#### シナリオ2: CLI開発者
```
1. tree-sitter-analyzer examples/BigService.java --output-format json
2. list-files --pattern "*.java" --output-file files.txt
3. search-content --pattern "class.*Service" --group-by-file
4. find-and-grep --file-pattern "*.py" --content-pattern "def test_"
```
**関連テスト:** `test_cli_comprehensive.py::test_cli_workflow`

#### シナリオ3: Python API直接呼出し
```python
from tree_sitter_analyzer import analyze_file

result = analyze_file("src/main.py")
print(result.summary)
```
**関連テスト:** `test_api.py::test_api_workflow`

### 3.2 エッジケースシナリオ

#### シナリオ4: 大規模プロジェクト解析
- 10,000ファイルプロジェクト
- 並行処理
- メモリ効率確認

**関連テスト:** `test_async_performance.py::test_large_project`

#### シナリオ5: エラー回復
- ネットワーク断
- ファイル削除
- 権限エラー

**関連テスト:** `test_cli_regression.py::test_error_recovery`

---

## 4. テストデータ

### 4.1 サンプルファイル (`examples/`)

| ファイル | 言語 | 行数 | 用途 |
|---------|------|------|------|
| BigService.java | Java | 2,000+ | 大規模ファイル |
| ModernJavaScript.js | JavaScript | 500+ | ES6+機能 |
| ComprehensiveTypeScript.ts | TypeScript | 600+ | 型システム |
| comprehensive_sample.html | HTML | 300+ | HTML5 |
| comprehensive_sample.css | CSS | 400+ | CSS3 |
| sample.py | Python | 200+ | 基本Python |

### 4.2 テストフィクスチャ (`tests/fixtures/`)

- 正常系ファイル
- 異常系ファイル（構文エラー含む）
- 空ファイル
- 巨大ファイル（100MB+）
- 特殊文字ファイル（Unicode、絵文字）

---

## 5. テスト実行

### 5.1 全テスト実行

```bash
# 全テスト実行（約10-15分）
uv run pytest

# 並行実行（高速化）
uv run pytest -n auto
```

### 5.2 カテゴリ別実行

```bash
# 単体テストのみ
uv run pytest -m unit

# 統合テストのみ
uv run pytest -m integration

# MCPテストのみ
uv run pytest -m mcp

# 高速テストのみ（slowマーカー除外）
uv run pytest -m "not slow"
```

### 5.3 言語別実行

```bash
# Javaテスト
uv run pytest tests/test_java_structure_analyzer.py

# JavaScriptテスト
uv run pytest tests/test_javascript_plugin_comprehensive.py

# MCPテスト
uv run pytest tests/test_mcp_*.py
```

---

## 6. カバレッジ詳細

### 6.1 モジュール別カバレッジ

| モジュール | ファイル数 | カバレッジ |
|-----------|-----------|-----------|
| `core/` | 15 | 90% |
| `languages/` | 10 | 85% |
| `mcp/` | 12 | 90% |
| `cli/` | 8 | 80% |
| `search/` | 5 | 88% |
| `cache/` | 3 | 92% |
| `security/` | 4 | 95% |

### 6.2 未カバー箇所

**優先対応が必要な箇所:**
- エラーハンドリングの一部
- 到達困難なエッジケース
- デバッグ用コード

**対応計画:** v2.0で追加テスト作成

---

## 7. テスト品質指標

### 7.1 現状の品質

| 指標 | 値 | 状態 |
|------|-----|------|
| **総テスト数** | 3,370+ | ✅ 優良 |
| **合格率** | 100% | ✅ 優良 |
| **カバレッジ** | ~85% | ✅ 良好 |
| **平均実行時間** | 15分 | ✅ 良好 |
| **フレーク率** | < 0.1% | ✅ 優良 |

### 7.2 トレンド

**テスト数の推移:**
- v1.0: 500件
- v1.5: 1,500件
- v1.8: 2,800件
- v1.9: 3,370件
- **成長率:** 年間+150%

**カバレッジの推移:**
- v1.0: 60%
- v1.5: 70%
- v1.8: 80%
- v1.9: 85%

---

## 8. 今後の改善計画

### 8.1 短期（3ヶ月）
- [ ] カバレッジ90%達成
- [ ] E2Eテスト150件追加
- [ ] パフォーマンステスト拡充

### 8.2 中期（6ヶ月）
- [ ] テスト数4,000件突破
- [ ] ミューテーションテスト導入
- [ ] 視覚的回帰テスト

### 8.3 長期（12ヶ月）
- [ ] AIベーステスト生成
- [ ] カオスエンジニアリング
- [ ] 継続的パフォーマンス監視

---

## 9. テストケース詳細へのリンク

### 9.1 テストファイル一覧

詳細なテストケースは以下のファイルを参照：

**コア機能:**
- `tests/test_core_engine_extended.py`
- `tests/test_core_query_service.py`
- `tests/test_api.py`

**言語プラグイン:**
- `tests/test_java_structure_analyzer.py`
- `tests/test_javascript_plugin_comprehensive.py`
- `tests/test_typescript_plugin.py`
- `tests/test_python_plugin.py`

**MCP統合:**
- `tests/test_mcp_async_integration.py`
- `tests/test_mcp_fd_rg_tools.py`
- `tests/test_mcp_query_tool_definition.py`

**CLI:**
- `tests/test_cli_comprehensive.py`
- `tests/test_cli_argument_validation.py`

**セキュリティ:**
- `tests/security/test_mcp_security.py`

### 9.2 テスト結果レポート

**最新テスト結果:** GitHub Actions  
**カバレッジレポート:** `htmlcov/index.html`  
**パフォーマンスレポート:** `benchmarks/`

---

## 改訂履歴

| バージョン | 日付 | 変更内容 | テスト数 |
|-----------|------|---------|---------|
| 1.0 | 2025-11-02 | 初版作成 | 3,370+ |
