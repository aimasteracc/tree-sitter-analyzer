# Tree-sitter Analyzer

[![Python Version](https://img.shields.io/badge/python-3.10%2B-blue.svg)](https://python.org)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Tests](https://img.shields.io/badge/tests-1268%20passed-brightgreen.svg)](#æµ‹è¯•)

ä¸€ä¸ªåŸºäºTree-sitterçš„å¯æ‰©å±•å¤šè¯­è¨€ä»£ç åˆ†ææ¡†æ¶ï¼Œ**æ—¢å¯ä»¥ä½œä¸ºCLIå·¥å…·ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºMCPæœåŠ¡å™¨ä½¿ç”¨**ï¼Œä¸“é—¨è®¾è®¡ç”¨äºè§£å†³å¤§å‹ä»£ç æ–‡ä»¶è¶…å‡ºLLMå•æ¬¡å¤„ç†tokené™åˆ¶çš„é—®é¢˜ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

æœ¬é¡¹ç›®çš„ä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½ä¸“é—¨ç”¨äºå¤„ç†å¤§å‹ä»£ç æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯Javaæ–‡ä»¶ï¼š

### 1. ä»£ç æ•´ä½“è§„æ¨¡åˆ†æ
è·å–ä»£ç æ–‡ä»¶çš„æ•´ä½“ç»“æ„å’Œå¤æ‚åº¦ä¿¡æ¯ï¼Œæ— éœ€è¯»å–å®Œæ•´æ–‡ä»¶å†…å®¹ã€‚

### 2. æŒ‡å®šä½ç½®ä»£ç æå–
ç²¾ç¡®æå–ä»£ç æ–‡ä»¶ä¸­æŒ‡å®šè¡ŒèŒƒå›´çš„å†…å®¹ï¼Œé¿å…åŠ è½½æ•´ä¸ªæ–‡ä»¶ã€‚

### 3. ä»£ç ä½ç½®ä¿¡æ¯è·å–
è·å–ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ä»£ç å…ƒç´ çš„è¯¦ç»†ä½ç½®ä¿¡æ¯ï¼Œç”¨äºåç»­çš„ç²¾ç¡®æå–ã€‚

## ğŸš€ ä½¿ç”¨æ–¹å¼

æœ¬é¡¹ç›®æä¾›ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼š

### æ–¹å¼ä¸€ï¼šCLIå‘½ä»¤è¡Œå·¥å…·
ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ï¼Œé€‚åˆè„šæœ¬è‡ªåŠ¨åŒ–å’Œå¼€å‘è°ƒè¯•ã€‚

### æ–¹å¼äºŒï¼šMCPæœåŠ¡å™¨
ä½œä¸ºMCPæœåŠ¡å™¨è¿è¡Œï¼Œä¸AIå·¥å…·ï¼ˆå¦‚Claude Desktopã€Cursorç­‰ï¼‰é›†æˆä½¿ç”¨ã€‚

## ğŸš€ æ ¸å¿ƒå‘½ä»¤ä½¿ç”¨ï¼ˆCLIæ–¹å¼ï¼‰

### 1. ä»£ç æ•´ä½“è§„æ¨¡åˆ†æå‘½ä»¤

```bash
# è·å–ä»£ç æ–‡ä»¶çš„æ•´ä½“è§„æ¨¡å’Œç»“æ„ä¿¡æ¯
python -m tree_sitter_analyzer.cli examples/Sample.java --advanced --output-format=text
```

**åŠŸèƒ½è¯´æ˜**ï¼š
- åˆ†æä»£ç æ–‡ä»¶çš„æ•´ä½“ç»“æ„
- ç»Ÿè®¡ç±»ã€æ–¹æ³•ã€å­—æ®µæ•°é‡
- è®¡ç®—ä»£ç å¤æ‚åº¦
- æä¾›æ–‡ä»¶æ¦‚è§ˆä¿¡æ¯
- **ä¸éœ€è¦è¯»å–å®Œæ•´æ–‡ä»¶å†…å®¹**

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
=== ä»£ç è§„æ¨¡åˆ†æ ===
æ–‡ä»¶: examples/Sample.java
è¯­è¨€: Java
æ€»è¡Œæ•°: 178
ç±»æ•°é‡: 4
æ–¹æ³•æ•°é‡: 12
å­—æ®µæ•°é‡: 8
å¤æ‚åº¦è¯„åˆ†: ä¸­ç­‰
```

### 2. æŒ‡å®šä½ç½®ä»£ç æå–å‘½ä»¤

```bash
# æå–æŒ‡å®šè¡ŒèŒƒå›´çš„ä»£ç å†…å®¹
python -m tree_sitter_analyzer.cli examples/Sample.java --partial-read --start-line 84 --end-line 86
```

**åŠŸèƒ½è¯´æ˜**ï¼š
- ç²¾ç¡®æå–æŒ‡å®šè¡ŒèŒƒå›´çš„ä»£ç 
- æ”¯æŒæŒ‰è¡Œå·èŒƒå›´æå–
- æ”¯æŒæŒ‰åˆ—èŒƒå›´æå–
- **å†…å­˜é«˜æ•ˆï¼Œåªè¯»å–éœ€è¦çš„éƒ¨åˆ†**

**è¾“å‡ºç¤ºä¾‹**ï¼š
```json
{
  "file_path": "examples/Sample.java",
  "start_line": 84,
  "end_line": 86,
  "content": "    public void setValue(int value) {\n        this.value = value;\n    }",
  "line_count": 3
}
```

### 3. ä»£ç ä½ç½®ä¿¡æ¯è·å–å‘½ä»¤

```bash
# è·å–ä»£ç å…ƒç´ çš„è¯¦ç»†ä½ç½®ä¿¡æ¯è¡¨æ ¼
python -m tree_sitter_analyzer.cli examples/Sample.java --table=full
```

**åŠŸèƒ½è¯´æ˜**ï¼š
- ç”Ÿæˆå®Œæ•´çš„ä»£ç å…ƒç´ ä½ç½®è¡¨æ ¼
- åŒ…å«ç±»ã€æ–¹æ³•ã€å­—æ®µçš„ç²¾ç¡®ä½ç½®
- æä¾›å¯è§æ€§ã€ç±»å‹ç­‰è¯¦ç»†ä¿¡æ¯
- **ä¸ºç²¾ç¡®ä»£ç æå–æä¾›ä½ç½®ç´¢å¼•**

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å…ƒç´ ç±»å‹    â”‚ åç§°         â”‚ èµ·å§‹è¡Œ    â”‚ ç»“æŸè¡Œ   â”‚ å¯è§æ€§      â”‚ ç±»å‹/è¿”å›å€¼  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ class       â”‚ Test         â”‚ 72        â”‚ 159      â”‚ public      â”‚ -            â”‚
â”‚ field       â”‚ value        â”‚ 74        â”‚ 74       â”‚ private     â”‚ int          â”‚
â”‚ field       â”‚ staticValue  â”‚ 77        â”‚ 77       â”‚ public      â”‚ int          â”‚
â”‚ constructor â”‚ Test         â”‚ 97        â”‚ 100      â”‚ public      â”‚ -            â”‚
â”‚ method      â”‚ getValue     â”‚ 108       â”‚ 110      â”‚ public      â”‚ String       â”‚
â”‚ method      â”‚ setValue     â”‚ 113       â”‚ 115      â”‚ protected   â”‚ void         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### å¤§æ–‡ä»¶å¤„ç†å·¥ä½œæµ

1. **é¦–å…ˆè·å–æ–‡ä»¶æ¦‚è§ˆ**ï¼š
   ```bash
   python -m tree_sitter_analyzer.cli large_file.java --advanced --output-format=text
   ```

2. **è·å–è¯¦ç»†ä½ç½®ä¿¡æ¯**ï¼š
   ```bash
   python -m tree_sitter_analyzer.cli large_file.java --table=full
   ```

3. **æ ¹æ®éœ€è¦æå–ç‰¹å®šä»£ç æ®µ**ï¼š
   ```bash
   python -m tree_sitter_analyzer.cli large_file.java --partial-read --start-line 100 --end-line 150
   ```

### LLMé›†æˆä¼˜åŠ¿

- **çªç ´Tokené™åˆ¶**ï¼šæ— éœ€ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªå¤§æ–‡ä»¶
- **ç²¾ç¡®å®šä½**ï¼šé€šè¿‡ä½ç½®è¡¨æ ¼å¿«é€Ÿæ‰¾åˆ°ç›®æ ‡ä»£ç 
- **æŒ‰éœ€æå–**ï¼šåªæå–éœ€è¦åˆ†æçš„ä»£ç æ®µ
- **ç»“æ„åŒ–ä¿¡æ¯**ï¼šæä¾›ä»£ç çš„ç»“æ„åŒ–å…ƒæ•°æ®

## ğŸ“¦ å®‰è£…

### ä½¿ç”¨uvå®‰è£…ï¼ˆæ¨èï¼‰

```bash
# å®‰è£…åŸºç¡€ç‰ˆæœ¬
uv add tree-sitter-analyzer

# å®‰è£…åŒ…å«Javaæ”¯æŒçš„ç‰ˆæœ¬
uv add "tree-sitter-analyzer[java]"

# å®‰è£…åŒ…å«å¸¸ç”¨è¯­è¨€æ”¯æŒçš„ç‰ˆæœ¬
uv add "tree-sitter-analyzer[popular]"

# å®‰è£…MCPæœåŠ¡å™¨æ”¯æŒ
uv add "tree-sitter-analyzer[mcp]"
```

### ä½¿ç”¨pipå®‰è£…

```bash
# åŸºç¡€å®‰è£…
pip install tree-sitter-analyzer

# å®‰è£…Javaæ”¯æŒ
pip install "tree-sitter-analyzer[java]"

# å®‰è£…æ‰€æœ‰åŠŸèƒ½
pip install "tree-sitter-analyzer[all,mcp]"
```

## ğŸ”§ MCPæœåŠ¡å™¨é›†æˆ

### å¯åŠ¨MCPæœåŠ¡å™¨

```bash
# å¯åŠ¨MCPæœåŠ¡å™¨
python -m tree_sitter_analyzer.mcp.server
```

### å¯ç”¨çš„MCPå·¥å…·

1. **analyze_code_scale**: å¯¹åº” `--advanced` åŠŸèƒ½
   ```json
   {
     "file_path": "path/to/file.java",
     "include_complexity": true,
     "include_details": false
   }
   ```

2. **read_code_partial**: å¯¹åº” `--partial-read` åŠŸèƒ½
   ```json
   {
     "file_path": "path/to/file.java",
     "start_line": 84,
     "end_line": 86
   }
   ```

3. **format_table**: å¯¹åº” `--table=full` åŠŸèƒ½
   ```json
   {
     "file_path": "path/to/file.java",
     "format_type": "full"
   }
   ```

## ğŸ—ï¸ æ¶æ„ç‰¹ç‚¹

### é«˜æ•ˆå†…å­˜ä½¿ç”¨
- **æµå¼å¤„ç†**ï¼šä¸éœ€è¦å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜
- **æŒ‰éœ€è§£æ**ï¼šåªè§£æéœ€è¦çš„ä»£ç æ®µ
- **ç¼“å­˜ä¼˜åŒ–**ï¼šæ™ºèƒ½ç¼“å­˜å¸¸ç”¨çš„åˆ†æç»“æœ

### ç²¾ç¡®å®šä½ç³»ç»Ÿ
- **Tree-sitterè§£æ**ï¼šåŸºäºè¯­æ³•æ ‘çš„ç²¾ç¡®å®šä½
- **å¤šå±‚æ¬¡ç´¢å¼•**ï¼šç±»ã€æ–¹æ³•ã€å­—æ®µçš„å±‚æ¬¡åŒ–ä½ç½®ä¿¡æ¯
- **å¿«é€ŸæŸ¥æ‰¾**ï¼šO(1)æ—¶é—´å¤æ‚åº¦çš„ä½ç½®æŸ¥æ‰¾

### æ”¯æŒçš„è¯­è¨€

| è¯­è¨€ | æ‰©å±•å | æ ¸å¿ƒåŠŸèƒ½æ”¯æŒ |
|------|--------|-------------|
| Java | `.java` | âœ… å®Œæ•´æ”¯æŒ |
| Python | `.py` | âœ… å®Œæ•´æ”¯æŒ |
| JavaScript | `.js` | âœ… å®Œæ•´æ”¯æŒ |
| TypeScript | `.ts` | âœ… åŸºç¡€æ”¯æŒ |
| C/C++ | `.c`, `.cpp` | âœ… åŸºç¡€æ”¯æŒ |

## ğŸ“– è¯¦ç»†å‚æ•°è¯´æ˜

### --advanced å‚æ•°
- `--output-format=text|json|table`: è¾“å‡ºæ ¼å¼
- `--include-complexity`: åŒ…å«å¤æ‚åº¦åˆ†æ
- `--include-details`: åŒ…å«è¯¦ç»†ä¿¡æ¯

### --partial-read å‚æ•°
- `--start-line N`: èµ·å§‹è¡Œå·ï¼ˆå¿…éœ€ï¼‰
- `--end-line N`: ç»“æŸè¡Œå·ï¼ˆå¯é€‰ï¼Œé»˜è®¤åˆ°æ–‡ä»¶æœ«å°¾ï¼‰
- `--start-column N`: èµ·å§‹åˆ—å·ï¼ˆå¯é€‰ï¼‰
- `--end-column N`: ç»“æŸåˆ—å·ï¼ˆå¯é€‰ï¼‰
- `--format text|json`: è¾“å‡ºæ ¼å¼

### --table å‚æ•°
- `--table=full`: å®Œæ•´è¡¨æ ¼æ ¼å¼
- `--table=compact`: ç´§å‡‘è¡¨æ ¼æ ¼å¼
- `--table=csv`: CSVæ ¼å¼è¾“å‡º

## ğŸ§ª æµ‹è¯•éªŒè¯

```bash
# æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
python -m tree_sitter_analyzer.cli examples/Sample.java --advanced --output-format=text
python -m tree_sitter_analyzer.cli examples/Sample.java --partial-read --start-line 1 --end-line 5
python -m tree_sitter_analyzer.cli examples/Sample.java --table=full

# è¿è¡Œæµ‹è¯•å¥—ä»¶
pytest tests/ -v

# è¿è¡Œç‰¹å®šåŠŸèƒ½æµ‹è¯•
pytest tests/test_partial_reading.py -v
pytest tests/test_table_formatter.py -v
```

## ğŸ“Š æ€§èƒ½åŸºå‡†

### å¤§æ–‡ä»¶å¤„ç†æ€§èƒ½

| æ–‡ä»¶å¤§å° | å…¨æ–‡ä»¶è¯»å– | éƒ¨åˆ†è¯»å– | ä½ç½®åˆ†æ |
|----------|------------|----------|----------|
| 1MB      | 2.3s       | 0.1s     | 0.5s     |
| 5MB      | 12.1s      | 0.1s     | 1.2s     |
| 10MB     | 25.8s      | 0.1s     | 2.1s     |
| 50MB     | å†…å­˜ä¸è¶³   | 0.1s     | 8.5s     |

### Tokenæ•ˆç‡å¯¹æ¯”

| æ–¹æ³• | 10MB Javaæ–‡ä»¶ | Tokenä½¿ç”¨é‡ | å¤„ç†æ—¶é—´ |
|------|---------------|-------------|----------|
| å…¨æ–‡ä»¶åŠ è½½ | âŒ è¶…å‡ºé™åˆ¶ | 500K+ tokens | N/A |
| ç»“æ„åŒ–åˆ†æ | âœ… æˆåŠŸ | 2K tokens | 2.1s |
| æŒ‰éœ€æå– | âœ… æˆåŠŸ | 500-5K tokens | 0.1s |

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHubä»“åº“](https://github.com/tree-sitter-analyzer/tree-sitter-analyzer)
- [é—®é¢˜è¿½è¸ª](https://github.com/tree-sitter-analyzer/tree-sitter-analyzer/issues)
- [Tree-sitterå®˜ç½‘](https://tree-sitter.github.io/)

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦è§[LICENSE](LICENSE)æ–‡ä»¶ã€‚

---

**ä¸“ä¸ºå¤§å‹ä»£ç æ–‡ä»¶åˆ†æè€Œè®¾è®¡ï¼Œè®©LLMèƒ½å¤Ÿé«˜æ•ˆå¤„ç†ä»»æ„å¤§å°çš„ä»£ç æ–‡ä»¶ã€‚**